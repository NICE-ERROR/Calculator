<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <link rel="shortcut icon" href="https://static.vecteezy.com/system/resources/previews/047/398/301/non_2x/cartoon-calculator-3d-icon-isolated-on-the-transparent-background-fintech-concept-design-png.png" />
    <script
      src="https://kit.fontawesome.com/4c536a6bd5.js"
      crossorigin="anonymous"
    ></script>
    <script defer></script>
    <script src='Periodic_table.js'></script>
    <link rel='stylesheet' href='style.css'/>
    <title>Calculator</title>
  </head>
  <body>
<header class="header">
  <h2 style="font-style: italic;">Calculator</h2> 
  <a class="PeriodicTable-ed" href="https://artsexperiments.withgoogle.com/periodic-table/">
    <button type="button" class="periodic-table">
      <P class="periodicTablelink">PeriodicTable</P>
    </button>
  </a>
  <a class="cal1" href="https://www.kidlek.com/scientific-calculator.php">
    <button type="button" class="change"></button>
  </a>
  <a href="https://github.com/NICE-ERROR" class="gitd">
    <button class="button1" target="_blank"></button>
    <i class="fab fa-github"></i>
  </a>

  </a>
</header>
  <div class="div">
    <input type="text" id="elementInput" class="input" placeholder="กรุณาใส่สัญลักษณ์ธาตุ เช่น H, O, Fe">
    <button class="ค้นหา" onclick="searchElement()">ค้นหา</button>
  </div>
  <div class="edout">
    <p class="output" id="elementResult"></p>
  </div>
  <div class="ligth"></div>
  <main class="main" >
    <div class="calculator" class="showef">
      <div class="screen">
        <div class="screen-last" id="lastOperationScreen"></div>
        <div class="screen-current" id="currentOperationScreen"></div>
      </div>
      <div class="buttons-grid">
        <button class="btn btn-red span-2" id="clearBtn" onclick="this.blur();">
          CLEAR 
        </button>
        <button class="btn btn-blue span-2" id="deleteBtn" onclick="this.blur();">
          DELETE
        </button>
        <!-- Add these buttons inside the buttons-grid div -->
        <!-- กำลังสร้างตัวแปร  in progress
        <button class="btn" onclick="this.blur();" id="openParenthesis" >(</button>
        <button class="btn" onclick="this.blur();" id="closeParenthesis" >)</button>
        -->
        <button class="Update" >_(_</button>
        <button class="Update" >_)_</button>
        <button class="btn" onclick="this.blur();" data-operator>^</button>
        <button class="btn" onclick="this.blur();" data-operator>√</button>

        <button class="btn" class="showef" onclick="this.blur();" data-number>7</button>
        <button class="btn" class="showef" onclick="this.blur();" data-number>8</button>
        <button class="btn" class="showef" onclick="this.blur();" data-number>9</button>
        <button class="btn" class="showef" onclick="this.blur();" data-operator>÷</button>

        <button class="btn" class="showef" onclick="this.blur();" data-number>4</button>
        <button class="btn" class="showef" onclick="this.blur();" data-number>5</button>
        <button class="btn" class="showef" onclick="this.blur();" data-number>6</button>
        <button class="btn" class="showef" onclick="this.blur();" data-operator>×</button>

        <button class="btn" onclick="this.blur();" data-number>1</button>
        <button class="btn" onclick="this.blur();" data-number>2</button>
        <button class="btn" onclick="this.blur();" data-number>3</button>
        <button class="btn" onclick="this.blur();" data-operator>−</button>

        <button class="btn" onclick="this.blur();" id="pointBtn">.</button>
        <button class="btn" onclick="this.blur();" data-number>0</button>
        <button class="btn" onclick="this.blur();" id="equalsBtn">=</button>
        <button class="btn" onclick="this.blur();" data-operator>+</button>
 
      </div>
    </div>
  </main>
  <script>
    let firstOperand = ''
let secondOperand = ''
let currentOperation = null
let shouldResetScreen = false
let isSquareRoot = false; 

const numberButtons = document.querySelectorAll('[data-number]')
const operatorButtons = document.querySelectorAll('[data-operator]')
const equalsButton = document.getElementById('equalsBtn')
const clearButton = document.getElementById('clearBtn')
const deleteButton = document.getElementById('deleteBtn')
const pointButton = document.getElementById('pointBtn')
const lastOperationScreen = document.getElementById('lastOperationScreen')
const currentOperationScreen = document.getElementById('currentOperationScreen')
  //const openParenthesisButton = document.getElementById('openParenthesis');
  //const closeParenthesisButton = document.getElementById('closeParenthesis');

window.addEventListener('keydown', handleKeyboardInput)
equalsButton.addEventListener('click', evaluate)
clearButton.addEventListener('click', clear)
deleteButton.addEventListener('click', deleteNumber)
pointButton.addEventListener('click', appendPoint)

numberButtons.forEach((button) =>
  button.addEventListener('click', () => appendNumber(button.textContent))
)

operatorButtons.forEach((button) =>
  button.addEventListener('click', () => setOperation(button.textContent))
)

function appendNumber(number) {
  if (currentOperationScreen.textContent === '0' || shouldResetScreen)
    resetScreen()
  currentOperationScreen.textContent += number
}

function resetScreen() {
  currentOperationScreen.textContent = ''
  shouldResetScreen = false
}

function clear() {
  currentOperationScreen.textContent = ''
  lastOperationScreen.textContent = ''
  firstOperand = ''
  secondOperand = ''
  currentOperation = null
}

function appendPoint() {
  if (shouldResetScreen) resetScreen()
  if (currentOperationScreen.textContent === '')
    currentOperationScreen.textContent = '0'
  if (currentOperationScreen.textContent.includes('.')) return
  currentOperationScreen.textContent += '.'
}

function deleteNumber() {
  currentOperationScreen.textContent = currentOperationScreen.textContent
    .toString()
    .slice(0, -1)
}

function setOperation(operator) {
  if (currentOperation !== null) evaluate()
  firstOperand = currentOperationScreen.textContent
  currentOperation = operator
  lastOperationScreen.textContent = `${firstOperand} ${currentOperation}`
  shouldResetScreen = true
}

function evaluate() {
  if (currentOperation === null || shouldResetScreen) return
  if (currentOperation === '÷' && currentOperationScreen.textContent === '0') {
    alert("You can't divide by 0!")
    return
  }
  secondOperand = currentOperationScreen.textContent
  currentOperationScreen.textContent = roundResult(
    operate(currentOperation, firstOperand, secondOperand)
  )
  lastOperationScreen.textContent = `${firstOperand} ${currentOperation} ${secondOperand} =`
  currentOperation = null
}

function roundResult(number) {
  return Math.round(number * 1000) / 1000
}

function handleKeyboardInput(e) {
  if (e.key >= 0 && e.key <= 9) appendNumber(e.key)
  if (e.key === '.') appendPoint()
  if (e.key === '=' || e.key === 'Enter') evaluate()
  if (e.key === 'Backspace') deleteNumber()
  if (e.key === 'Escape') clear()
  if (e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/')
    setOperation(convertOperator(e.key))
}

function setOperation(operator) {
    if (currentOperation !== null) evaluate()
    firstOperand = currentOperationScreen.textContent
    currentOperation = operator
    lastOperationScreen.textContent = `${firstOperand} ${currentOperation}`
    shouldResetScreen = true
}

function setOperation(operator) {
    if (operator === '√') {
      isSquareRoot = true;  // ตั้งค่าว่ากำลังจะคำนวณรากที่สอง
      currentOperation = operator;
      lastOperationScreen.textContent = `√`;  // แสดงเครื่องหมายรากที่สอง
      return;
    }
  
    if (currentOperation !== null) evaluate();
    firstOperand = currentOperationScreen.textContent;
    currentOperation = operator;
    lastOperationScreen.textContent = `${firstOperand} ${currentOperation}`;
    shouldResetScreen = true;
}
  
function evaluate() {
    if (currentOperation === null || shouldResetScreen) return
    if (currentOperation === '÷' && currentOperationScreen.textContent === '0') {
        alert("You can't divide by 0!")
        return
    }
    secondOperand = currentOperationScreen.textContent
    currentOperationScreen.textContent = roundResult(
        operate(currentOperation, firstOperand, secondOperand)
    )
    lastOperationScreen.textContent = `${firstOperand} ${currentOperation} ${secondOperand} =`
    currentOperation = null

}

function roundResult(number) {
    return Math.round(number * 1000) / 1000
}

function handleKeyboardInput(e) {
    if (e.key >= 0 && e.key <= 9) appendNumber(e.key)
    if (e.key === '.') appendPoint()
    if (e.key === '=' || e.key === 'Enter') evaluate()
    if (e.key === 'Backspace') deleteNumber()
    if (e.key === 'Escape') clear()
    if (e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/')
        setOperation(convertOperator(e.key))
    if (e.key === '^') setOperation('^')  // Handle exponentiation key
    if (e.key === '√') setOperation('√')  // Handle square root key
    if (e,key === '(') setOperation('(')
    if (e.key === ')') setOperation('(')
}

function convertOperator(keyboardOperator) {
    if (keyboardOperator === '/') return '÷'
    if (keyboardOperator === '*') return '×'
    if (keyboardOperator === '-') return '−'
    if (keyboardOperator === '+') return '+'
    if (keyboardOperator === '^') return '^'  // Exponentiation operator
    if (keyboardOperator === '√') return '√'  // Square root operator
    if (keyboardOperator === '(') return '('
    if (keyboardOperator === '(') return ')'
}

function add(a, b) {
    return a + b
}

function substract(a, b) {
    return a - b
}

function multiply(a, b) {
    return a * b
}

function divide(a, b) {
    return a / b
}

function setOperation(operator) {
    if (operator === '√') {
      isSquareRoot = true;  // ตั้งค่าว่ากำลังจะคำนวณรากที่สอง
      currentOperation = operator;
      lastOperationScreen.textContent = `√`;  // แสดงเครื่องหมายรากที่สอง
      return;
    }
  
    if (currentOperation !== null) evaluate();
    firstOperand = currentOperationScreen.textContent;
    currentOperation = operator;
    lastOperationScreen.textContent = `${firstOperand} ${currentOperation}`;
    shouldResetScreen = true;
  }
  
  // ฟังก์ชันสำหรับการคำนวณ
function evaluate() {
    if (currentOperation === null && !isSquareRoot) return;
    
    if (isSquareRoot) {
      // ถ้าเป็นการคำนวณรากที่สอง
      firstOperand = currentOperationScreen.textContent || '0';  // ถ้าไม่มีตัวเลขใช้ค่า 0
      const result = Math.sqrt(Number(firstOperand));  // คำนวณรากที่สอง
      currentOperationScreen.textContent = roundResult(result);  // แสดงผลลัพธ์
      lastOperationScreen.textContent = `√${firstOperand} =`;  // แสดงผลการคำนวณ
      isSquareRoot = false;  // รีเซ็ตตัวแปร
      return;
    }

    secondOperand = currentOperationScreen.textContent;
    currentOperationScreen.textContent = roundResult(
      operate(currentOperation, firstOperand, secondOperand)
    );
    lastOperationScreen.textContent = `${firstOperand} ${currentOperation} ${secondOperand} =`;
    currentOperation = null;
}
  
function operate(operator, a, b) {
    a = Number(a);
    b = Number(b);
    switch (operator) {
      case '+':
        return add(a, b);
      case '−':
        return substract(a, b);
      case '×':
        return multiply(a, b);
      case '÷':
        if (b === 0) return null;
        else return divide(a, b);
      case '^':
        return Math.pow(a, b);  // Exponentiation logic
      default:
        return null;
    }
}

  </script>

  <script> // in progress
//    const calculator =document.querySelector('.calculator');
//    const light = document.querySelector('.light');

//    document.addEventListener('mousemove' ,
//      (event) => {
//        const mouseX = event.clientX;
//        const mouseY = event.clientY;
//        light.style.left = mouseX + 'px';
//        light.style.top = mouseY + 'px' ;

//        const distanceX = mouseX - text.offsetLeft - text.offsetWidth / 2 ;
//        const distanceY = mouseY - text.offsetLeft - text.offsetHeight / 2 ;

//        let newShadow = '' 
//        for (let i = 0; i < 200; i++) 
//        { const shadowX = -distanceX * (i / 200) ; 
//          const shadowY = -distanceY * (i / 200) ; 
//          const opacity = 1 - (i / 100);
//           newShadow += (newShadow ? ',' : '') + `${shadowX}px 
//           ${shadowY}px 0 rgba(33,33,33,
//           ${opacity})`;
//        } calculator.stye.textShadow = newShadow;
//      }
//    );
  </script>

<script>
  // เลือกปุ่มทั้งหมดที่มี 
const buttons = document.querySelectorAll('.btn, .class1, .change, .ค้นหา');

// วนลูปผ่านแต่ละปุ่มและเพิ่มแอนิเมชัน
buttons.forEach(button => {
  button.addEventListener('touchstart', function() {
    this.style.transform = 'scale(0.95)';
  });

  button.addEventListener('touchend', function() {
    this.style.transform = 'scale(1)';
  });
});
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
            if (window.matchMedia('(hover: hover)').matches) {
                document.querySelectorAll('button').forEach(button => {
                    button.addEventListener('mousedown', function(e) {
                        e.preventDefault();  // Disable active on desktop
                    });
                });
            }
        });
</script>

<style>
  button {
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s ease;
        }
</style>
</body>
</html>
